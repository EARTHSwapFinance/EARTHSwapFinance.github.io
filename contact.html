<!DOCTYPE html>
<html>
  <head>
    <title>My awesome app</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  </head>
  <body>
    <h1>Welcome to my app!</h1>
    <input type="email" id="email" placeholder="Enter your email...">
    <input type="text" id="referralCode" placeholder="Referral code">
    <button id="submit">Sign up</button>
    <script>
      $('#submit').on('click', function(e) {
        e.preventDefault();
        $.ajax({
          url: '/',
          type: "POST",
          data: {
            'email': $('#email').val(),
            'referrer': $('#referralCode').val()
          },
          success: function(res) {
            alert('Your referral code is: ' + res.referralCode);
          },
          error: function(jqXHR, textStatus, errorMessage) {
            alert(errorMessage);
          }
        });
      })
	    var express = require('express');
var router = express.Router();
var mysql = require('mysql');
var shortid = require('shortid');

/* New POST route for form submissions */
router.post('/', function(req, res, next) {

  /* establish mysql connection */
  var connection = mysql.createConnection({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASS,
    database: process.env.DB_NAME
  });

  /* user's email address */
  let email = req.body.email;

  /* a unique referral code the user can share */
  let referral_code = shortid.generate();

  /* the referral code a user submitted (might be null) */ 
  let referrer = req.body.referrer;

  /* add user to the database with INSERT */
  let query = "INSERT INTO `users` (`email`, `referral_code`, `referrer`) VALUES (?, ?, ?)";
  connection.query(query, [email, referral_code, referrer], (err, rows) => {
    connection.end(function() {
      if (err) return next();
      return res.send({referralCode: referral_code});
    });
  });
});

/* GET home page. */
router.get('/', function(req, res, next) {
  res.render('index');
});

module.exports = router;
    </script>
  </body>
</html>
